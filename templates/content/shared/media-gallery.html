{% load static %}

<div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6"
     x-data="{ 
         view: 'grid',
         selectedMedia: null,
         isModalOpen: false,
         currentIndex: 0,
         media: {{ media_items|safe }},
         
         next() {
             this.currentIndex = (this.currentIndex + 1) % this.media.length;
             this.selectedMedia = this.media[this.currentIndex];
         },
         
         previous() {
             this.currentIndex = (this.currentIndex - 1 + this.media.length) % this.media.length;
             this.selectedMedia = this.media[this.currentIndex];
         }
     }">
    
    <!-- Gallery Header -->
    <div class="flex items-center justify-between mb-6">
        <h2 class="text-xl font-bold text-gray-900 dark:text-white">Media Gallery</h2>
        
        <!-- View Toggle -->
        <div class="flex items-center space-x-2">
            <button @click="view = 'grid'"
                    :class="{'text-primary-600 dark:text-primary-400': view === 'grid',
                            'text-gray-400 dark:text-gray-600': view !== 'grid'}"
                    class="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                          d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"></path>
                </svg>
            </button>
            <button @click="view = 'list'"
                    :class="{'text-primary-600 dark:text-primary-400': view === 'list',
                            'text-gray-400 dark:text-gray-600': view !== 'list'}"
                    class="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                          d="M4 6h16M4 10h16M4 14h16M4 18h16"></path>
                </svg>
            </button>
        </div>
    </div>
    
    <!-- Gallery Grid View -->
    <div x-show="view === 'grid'"
         class="grid grid-cols-2 sm:grid-cols-3 gap-4">
        {% for item in media_items %}
        <div class="relative group aspect-square cursor-pointer"
             @click="selectedMedia = {{ item|safe }}; 
                     currentIndex = {{ forloop.counter0 }}; 
                     isModalOpen = true">
            <img src="{{ item.thumbnail_url }}" 
                 alt="{{ item.title }}"
                 class="absolute inset-0 w-full h-full object-cover rounded-lg">
                 
            <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-40 transition-opacity duration-300 rounded-lg"></div>
            
            <div class="absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                <span class="bg-black bg-opacity-75 text-white px-3 py-1 rounded-full text-sm">
                    {{ item.type }}
                </span>
            </div>
        </div>
        {% endfor %}
    </div>
    
    <!-- Gallery List View -->
    <div x-show="view === 'list'"
         class="space-y-4">
        {% for item in media_items %}
        <div class="flex items-center space-x-4 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600"
             @click="selectedMedia = {{ item|safe }}; 
                     currentIndex = {{ forloop.counter0 }}; 
                     isModalOpen = true">
            <div class="w-20 h-20 flex-shrink-0">
                <img src="{{ item.thumbnail_url }}" 
                     alt="{{ item.title }}"
                     class="w-full h-full object-cover rounded-lg">
            </div>
            
            <div class="flex-grow">
                <h3 class="text-gray-900 dark:text-white font-medium">{{ item.title }}</h3>
                <p class="text-sm text-gray-500 dark:text-gray-400">
                    {{ item.type }} â€¢ {{ item.size }}
                </p>
            </div>
            
            <div class="text-gray-400 dark:text-gray-500">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                          d="M9 5l7 7-7 7"></path>
                </svg>
            </div>
        </div>
        {% endfor %}
    </div>
    
    <!-- Media Modal -->
    <div x-show="isModalOpen"
         x-cloak
         class="fixed inset-0 z-50 overflow-y-auto"
         @keydown.escape="isModalOpen = false">
        <div class="flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0">
            <!-- Background overlay -->
            <div class="fixed inset-0 transition-opacity"
                 @click="isModalOpen = false">
                <div class="absolute inset-0 bg-black opacity-75"></div>
            </div>
            
            <!-- Modal panel -->
            <div class="inline-block align-bottom bg-white dark:bg-gray-800 rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-4xl sm:w-full">
                <div class="bg-white dark:bg-gray-800 px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                    <!-- Media Content -->
                    <div class="relative">
                        <template x-if="selectedMedia.type === 'image'">
                            <img :src="selectedMedia.url"
                                 :alt="selectedMedia.title"
                                 class="w-full rounded-lg">
                        </template>
                        
                        <template x-if="selectedMedia.type === 'video'">
                            <video controls class="w-full rounded-lg">
                                <source :src="selectedMedia.url" :type="selectedMedia.mime_type">
                                Your browser does not support the video tag.
                            </video>
                        </template>
                        
                        <!-- Navigation Buttons -->
                        <button @click="previous"
                                class="absolute left-4 top-1/2 transform -translate-y-1/2 bg-black bg-opacity-50 text-white p-2 rounded-full hover:bg-opacity-75">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                            </svg>
                        </button>
                        
                        <button @click="next"
                                class="absolute right-4 top-1/2 transform -translate-y-1/2 bg-black bg-opacity-50 text-white p-2 rounded-full hover:bg-opacity-75">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                            </svg>
                        </button>
                    </div>
                    
                    <!-- Media Info -->
                    <div class="mt-4">
                        <h3 class="text-lg font-medium text-gray-900 dark:text-white" x-text="selectedMedia.title"></h3>
                        <p class="mt-1 text-sm text-gray-500 dark:text-gray-400" x-text="selectedMedia.description"></p>
                    </div>
                </div>
                
                <!-- Modal Footer -->
                <div class="bg-gray-50 dark:bg-gray-700 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                    <button @click="isModalOpen = false"
                            type="button"
                            class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-primary-600 text-base font-medium text-white hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 sm:ml-3 sm:w-auto sm:text-sm">
                        Close
                    </button>
                    
                    <a :href="selectedMedia.download_url"
                       download
                       class="mt-3 sm:mt-0 w-full inline-flex justify-center rounded-md border border-gray-300 dark:border-gray-600 shadow-sm px-4 py-2 bg-white dark:bg-gray-800 text-base font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 sm:ml-3 sm:w-auto sm:text-sm">
                        Download
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
