{% load static %}

<nav class="nav-container">
    <!-- Primary Navigation -->
    <div class="nav-section" x-data="{ mobileMenuOpen: false, moreMenuOpen: false }">
        <a href="{% url 'core:home' %}" class="nav-link {% if request.resolver_match.url_name == 'home' %}active{% endif %}" data-nav-text>
            Home
        </a>
        <a href="{% url 'content:article_list' %}" class="nav-link {% if 'articles' in request.path %}active{% endif %}" data-nav-text>
            Articles
        </a>
        <a href="{% url 'content:magazine_list' %}" class="nav-link {% if 'magazines' in request.path %}active{% endif %}" data-nav-text>
            Magazines
        </a>
        <a href="{% url 'archives:browse' %}" class="nav-link {% if 'archives' in request.resolver_match.app_name %}active{% endif %}" data-nav-text>
            Archives
        </a>
        
        <!-- More Menu -->
        <div class="relative" @click.away="moreMenuOpen = false">
            <button 
                @click="moreMenuOpen = !moreMenuOpen" 
                class="nav-link flex items-center gap-1" 
                aria-haspopup="true" 
                :aria-expanded="moreMenuOpen"
                data-nav-text
            >
                <span>More</span>
                <svg 
                    class="w-4 h-4 transition-transform duration-200" 
                    :class="{ 'rotate-180': moreMenuOpen }"
                    fill="none" 
                    stroke="currentColor" 
                    viewBox="0 0 24 24"
                >
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                </svg>
            </button>

            <!-- Dropdown Menu -->
            <div 
                x-show="moreMenuOpen"
                x-transition:enter="transition ease-out duration-200"
                x-transition:enter-start="opacity-0 transform scale-95"
                x-transition:enter-end="opacity-100 transform scale-100"
                x-transition:leave="transition ease-in duration-150"
                x-transition:leave-start="opacity-100 transform scale-100"
                x-transition:leave-end="opacity-0 transform scale-95"
                class="absolute right-0 mt-2 w-48 rounded-md shadow-lg bg-white dark:bg-gray-800 ring-1 ring-black ring-opacity-5"
                style="display: none;"
            >
                <div class="py-1" role="menu" aria-orientation="vertical">
                    <a href="{% url 'core:about' %}" class="nav-dropdown-item" role="menuitem" data-nav-text>
                        About Us
                    </a>
                    <a href="{% url 'core:contact' %}" class="nav-dropdown-item" role="menuitem" data-nav-text>
                        Contact
                    </a>
                    <a href="{% url 'core:advertise' %}" class="nav-dropdown-item" role="menuitem" data-nav-text>
                        Advertise
                    </a>
                </div>
            </div>
        </div>

        <!-- Mobile Menu Button -->
        <button 
            class="mobile-menu-button md:hidden"
            @click="mobileMenuOpen = !mobileMenuOpen"
            aria-label="Toggle mobile menu"
        >
            <svg 
                class="w-6 h-6"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
            >
                <path 
                    x-show="!mobileMenuOpen"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M4 6h16M4 12h16M4 18h16"
                />
                <path
                    x-show="mobileMenuOpen"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M6 18L18 6M6 6l12 12"
                />
            </svg>
        </button>
    </div>

    <!-- Mobile Menu -->
    <div 
        x-show="mobileMenuOpen"
        x-transition:enter="transition ease-out duration-200"
        x-transition:enter-start="opacity-0 transform -translate-y-2"
        x-transition:enter-end="opacity-100 transform translate-y-0"
        x-transition:leave="transition ease-in duration-150"
        x-transition:leave-start="opacity-100 transform translate-y-0"
        x-transition:leave-end="opacity-0 transform -translate-y-2"
        class="md:hidden"
        style="display: none;"
    >
        <div class="px-2 pt-2 pb-3 space-y-1">
            <a href="{% url 'core:home' %}" class="mobile-nav-link" data-nav-text>Home</a>
            <a href="{% url 'content:article_list' %}" class="mobile-nav-link" data-nav-text>Articles</a>
            <a href="{% url 'content:magazine_list' %}" class="mobile-nav-link" data-nav-text>Magazines</a>
            <a href="{% url 'archives:browse' %}" class="mobile-nav-link" data-nav-text>Archives</a>
            <a href="{% url 'core:about' %}" class="mobile-nav-link" data-nav-text>About Us</a>
            <a href="{% url 'core:contact' %}" class="mobile-nav-link" data-nav-text>Contact</a>
            <a href="{% url 'core:advertise' %}" class="mobile-nav-link" data-nav-text>Advertise</a>
        </div>
    </div>
</nav>

<script>
    // Mobile Menu Toggle
    document.addEventListener('DOMContentLoaded', function() {
        const mobileMenuButton = document.querySelector('.mobile-menu-button');
        const mobileMenuClose = document.querySelector('.mobile-menu-close');
        const mobileMenu = document.querySelector('.mobile-menu');

        function toggleMobileMenu() {
            mobileMenu.classList.toggle('hidden');
            document.body.classList.toggle('overflow-hidden');
        }

        mobileMenuButton.addEventListener('click', toggleMobileMenu);
        mobileMenuClose.addEventListener('click', toggleMobileMenu);

        // Close menu when clicking outside
        mobileMenu.addEventListener('click', function(e) {
            if (e.target === this) {
                toggleMobileMenu();
            }
        });
    });
</script>
