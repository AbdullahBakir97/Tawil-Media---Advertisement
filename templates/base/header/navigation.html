{% load static %}

<nav class="nav-container">
    <!-- Primary Navigation -->
    <div class="nav-section" x-data="{ mobileMenuOpen: false, moreMenuOpen: false }">
        <a href="{% url 'core:home' %}" class="nav-link {% if request.resolver_match.url_name == 'home' %}active{% endif %}">
            Home
        </a>
        <a href="{% url 'content:article_list' %}" class="nav-link {% if 'articles' in request.path %}active{% endif %}">
            Articles
        </a>
        <a href="{% url 'content:magazine_list' %}" class="nav-link {% if 'magazines' in request.path %}active{% endif %}">
            Magazines
        </a>
        <a href="{% url 'archives:browse' %}" class="nav-link {% if 'archives' in request.resolver_match.app_name %}active{% endif %}">
            Archives
        </a>
        
        <!-- More Menu -->
        <div class="relative" @click.away="moreMenuOpen = false">
            <button 
                @click="moreMenuOpen = !moreMenuOpen" 
                class="nav-link flex items-center gap-1" 
                aria-haspopup="true" 
                :aria-expanded="moreMenuOpen"
            >
                <span>More</span>
                <svg 
                    class="w-4 h-4 transition-transform duration-200" 
                    :class="{ 'rotate-180': moreMenuOpen }"
                    fill="none" 
                    stroke="currentColor" 
                    viewBox="0 0 24 24"
                >
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                </svg>
            </button>
            
            <div 
                x-show="moreMenuOpen"
                x-transition:enter="transition ease-out duration-100"
                x-transition:enter-start="transform opacity-0 scale-95"
                x-transition:enter-end="transform opacity-100 scale-100"
                x-transition:leave="transition ease-in duration-75"
                x-transition:leave-start="transform opacity-100 scale-100"
                x-transition:leave-end="transform opacity-0 scale-95"
                class="nav-dropdown"
                style="display: none;"
            >
                <a href="{% url 'core:about' %}" class="nav-dropdown-item">
                    About Us
                </a>
                <a href="{% url 'core:contact' %}" class="nav-dropdown-item">
                    Contact
                </a>
                <a href="{% url 'core:advertise' %}" class="nav-dropdown-item">
                    Advertise
                </a>
            </div>
        </div>
    </div>

    <!-- Mobile Menu Button -->
    <button 
        class="mobile-menu-button md:hidden"
        @click="mobileMenuOpen = !mobileMenuOpen"
        aria-label="Toggle mobile menu"
    >
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path 
                x-show="!mobileMenuOpen" 
                stroke-linecap="round" 
                stroke-linejoin="round" 
                stroke-width="2" 
                d="M4 6h16M4 12h16M4 18h16"
            ></path>
            <path 
                x-show="mobileMenuOpen" 
                stroke-linecap="round" 
                stroke-linejoin="round" 
                stroke-width="2" 
                d="M6 18L18 6M6 6l12 12"
            ></path>
        </svg>
    </button>

    <!-- Mobile Navigation -->
    <div 
        x-show="mobileMenuOpen"
        x-transition:enter="transition ease-out duration-100"
        x-transition:enter-start="transform opacity-0 scale-95"
        x-transition:enter-end="transform opacity-100 scale-100"
        x-transition:leave="transition ease-in duration-75"
        x-transition:leave-start="transform opacity-100 scale-100"
        x-transition:leave-end="transform opacity-0 scale-95"
        class="mobile-menu fixed inset-0 z-50"
    >
        <div class="absolute right-0 top-0 bottom-0 w-64 bg-white dark:bg-gray-800 shadow-xl">
            <div class="p-4 border-b dark:border-gray-700">
                <div class="flex items-center justify-between">
                    <h2 class="text-xl font-semibold">Menu</h2>
                    <button 
                        class="mobile-menu-button" 
                        @click="mobileMenuOpen = false"
                        aria-label="Close menu"
                    >
                        <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
            </div>
            <nav class="p-4">
                <a href="{% url 'core:home' %}" class="mobile-nav-link {% if request.resolver_match.url_name == 'home' %}active{% endif %}">
                    Home
                </a>
                <a href="{% url 'content:article_list' %}" class="mobile-nav-link {% if 'articles' in request.path %}active{% endif %}">
                    Articles
                </a>
                <a href="{% url 'content:magazine_list' %}" class="mobile-nav-link {% if 'magazines' in request.path %}active{% endif %}">
                    Magazines
                </a>
                <a href="{% url 'archives:browse' %}" class="mobile-nav-link {% if 'archives' in request.resolver_match.app_name %}active{% endif %}">
                    Archives
                </a>
                <div class="border-t dark:border-gray-700 my-4"></div>
                <a href="{% url 'core:about' %}" class="mobile-nav-link">About Us</a>
                <a href="{% url 'core:contact' %}" class="mobile-nav-link">Contact</a>
                <a href="{% url 'core:advertise' %}" class="mobile-nav-link">Advertise</a>
            </nav>
        </div>
    </div>
</nav>

<script>
    // Mobile Menu Toggle
    document.addEventListener('DOMContentLoaded', function() {
        const mobileMenuButton = document.querySelector('.mobile-menu-button');
        const mobileMenuClose = document.querySelector('.mobile-menu-close');
        const mobileMenu = document.querySelector('.mobile-menu');

        function toggleMobileMenu() {
            mobileMenu.classList.toggle('hidden');
            document.body.classList.toggle('overflow-hidden');
        }

        mobileMenuButton.addEventListener('click', toggleMobileMenu);
        mobileMenuClose.addEventListener('click', toggleMobileMenu);

        // Close menu when clicking outside
        mobileMenu.addEventListener('click', function(e) {
            if (e.target === this) {
                toggleMobileMenu();
            }
        });
    });
</script>
